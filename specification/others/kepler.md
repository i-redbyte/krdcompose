# Симулятор орбит

> Учебное Android-приложение, иллюстрирующее ньютоновскую динамику
>
и [законы Кеплера.](https://ru.wikipedia.org/wiki/%D0%97%D0%B0%D0%BA%D0%BE%D0%BD%D1%8B_%D0%9A%D0%B5%D0%BF%D0%BB%D0%B5%D1%80%D0%B0)  
> Меняйте тип орбиты, эксцентриситет, цвета и ограничения мира — наблюдайте траекторию, скорость и
> ускорение в реальном времени.

---

## Содержание

- [Демо](#демо)
- [Возможности](#возможности)
- [Технический обзор](#технический-обзор)
- [Использование](#использование)
    - [Экран настроек](#экран-настроек)
    - [Экран симуляции](#экран-симуляции)
    - [Жесты и управление камерой](#жесты-и-управление-камерой)
- [Пресеты орбит](#пресеты-орбит)
- [Математика (коротко)](#математика-коротко)
- [Роадмап](#роадмап)
- [Вклад в проект](#вклад-в-проект)

---

## Демо

> ![Demo](/specification/others/img/kepler.gif)

---

## Возможности

- **Типы орбит**: Circular, Elliptical, Parabolic, Hyperbolic
- **Параметры**: начальная дистанция, эксцентриситет (для эллипса и гиперболы)
- **Ограничения мира**: авто-масштабирование, режим границ (Bounce/Stop), внутренние поля, макс.
  радиус
- **Визуализация**: траектория, вектор скорости, вектор ускорения, HUD c r, v, e, a, T
- **Скорость симуляции**: 0.1× … 5×
- **Пауза/Пуск**
- **Скриншот и шаринг** результата (PNG, через `MediaStore`)
- **Жесты**: масштабирование и панорамирование (при отключённом авто-масштабе)
- **Сохранение состояния** через `rememberSaveable` и `listSaver`

---

## Технический обзор

- **Язык**: Kotlin
- **UI**: Jetpack Compose (Material 3)
- **Архитектура**: простая, состояние в `@Composable` с `rememberSaveable`
- **Асинхронность**: `kotlinx.coroutines` (`LaunchedEffect`, `while (isActive)`)
- **Отрисовка**: `Canvas` + свои утилиты (`TrailPathCache`, стрелки и пр.)
- **Минимальная версия Android**: `minSdk 24`
- **Скриншоты**: `view.drawToBitmap()` → PNG → `MediaStore` → шаринг `Intent.ACTION_SEND`

---

## Использование

### Экран настроек

- Выбор **типа орбиты** (`OrbitType`)
- Параметры:
    - **Начальная дистанция** (минимум 1.0)
    - **Эксцентриситет**:
        - Эллипс: `0.0 … 0.99`
        - Гипербола: `1.1 … 5.0`
- **Пресеты**: LEO, Elliptic, Parabolic, Hyperbolic
- **Ограничения мира**:
    - Авто-масштабирование (**Scale to fit**)
    - Режим границ (**Bounce**/**Stop**)
    - Внутренние поля экрана (доля)
    - Множитель макс. радиуса мира
- **Цвета**: фон, звезда, планета, траектория, скорость, ускорение
- **Визуализация**: включить/выключить траекторию, вектор скорости и ускорения
- Кнопка **Старт** — перейти к симуляции

### Экран симуляции

- Верхняя панель:
    - **Пауза/Пуск**
    - **Снимок** — сохранить PNG и открыть системный шаринг
    - **Назад** — к настройкам
- Поле симуляции:
    - Звезда в центре, планета, след траектории (если включён)
    - Пунктир — предсказанная траектория на горизонт `steps`
    - **HUD** слева сверху: `r, v, e, a, T`
- Нижняя панель:
    - Слайдер скорости симуляции `0.1× … 5×`

### Жесты и управление камерой

- Если **авто-масштабирование включено** — камера следует за объектом и масштаб адаптивный.
- Если **авто-масштабирование выключено**:
    - **Pinch** — масштаб (ограничен `0.3× … 5×`)
    - **Pan** — перемещение камеры по миру
- Режим границ:
    - **Bounce**: отскок от границ мира
    - **Stop**: останавливаться на границе

---

## Конфигурация проекта

Основные параметры, которые можно подстраивать:

- `WorldConstraints.maxWorldRadiusMultiplier` — радиус «мира» = множитель × начальная дистанция
- `WorldConstraints.paddingFraction` — внутреннее поле (в доле от меньшей стороны экрана)
- `TrailPathCache(maxPoints, minSegmentWorld)` — длина и дискретизация следа
- Горизонт и шаг предсказания траектории (в корутине расчёта `futurePath`)

---

## Пресеты орбит

- **LEO**: круговая, `distance = 100.0`
- **Elliptic**: эллиптическая, `distance = 120.0, e = 0.8`
- **Parabolic**: параболическая, `distance = 100.0`
- **Hyperbolic**: гиперболическая, `distance = 100.0, e = 2.0`

---

## Математика (коротко)

- Гравитационный параметр: `μ = GM = 1.0` (безразмерный, для наглядности)
- Ускорение:
  ```
  a = -μ * r / |r|^3
  ```
- Начальные скорости:
    - Circular:   `v = sqrt(μ / r)`
    - Elliptical: `v = sqrt(μ * (1 - e) / r)`
    - Parabolic:  `v = sqrt(2μ / r)`
    - Hyperbolic: `v = sqrt(μ * (1 + e) / r)`
- В HUD дополнительно вычисляются: удельная энергия `ε`, большая полуось `a`, эксцентриситет `e`,
  период `T` (для эллипса)

---

## Роадмап

- Многотельная динамика (несколько планет, двойные звезды)
- Экспорт/импорт настроек в JSON
- Съёмка GIF/видео
- Улучшенные подсказки ― апоцентр/перицентр, аргумент перицентра, наклон
- KMM или Compose Multiplatform для desktop/web демо

---

## Вклад в проект

PR и обсуждения приветствуются:

1. Форкните репозиторий
2. Создайте ветку из `master`: `feature/my-improvement`
3. Коммитите атомарно с понятными сообщениями
4. Открывайте Pull Request с кратким описанием цели и скриншотами (если UI)
