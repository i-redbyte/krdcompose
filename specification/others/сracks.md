# üî® –¢—Ä–µ—â–µ–Ω–∫–∏ (Crack Effect)

–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç —Ç—Ä–µ—â–∏–Ω –ø–æ —ç–∫—Ä–∞–Ω—É –¥–ª—è Jetpack Compose, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ AGSL-—à–µ–π–¥–µ—Ä–∞—Ö (Android
Graphics Shading Language).

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç–∞–ø–∞–µ—Ç –ø–æ —ç–∫—Ä–∞–Ω—É ‚Äî –≤ —ç—Ç–æ–º –º–µ—Å—Ç–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è ¬´—Ç–æ—á–∫–∞ —É–¥–∞—Ä–∞¬ª, –æ—Ç –∫–æ—Ç–æ—Ä–æ–π —Ä–∞—Å—Ö–æ–¥—è—Ç—Å—è —Ç—Ä–µ—â–∏–Ω—ã
–∏ –ª—ë–≥–∫–æ–µ –∏—Å–∫–∞–∂–µ–Ω–∏–µ —Ñ–æ–Ω–∞. –ü–æ–≤—Ç–æ—Ä–Ω—ã–π —Ç–∞–ø —Ä—è–¥–æ–º —Å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ç—Ä–µ—â–∏–Ω–æ–π —É—Å–∏–ª–∏–≤–∞–µ—Ç –µ—ë, —É—Å–ª–æ–∂–Ω—è—è
—Ä–∏—Å—É–Ω–æ–∫.

---

## üëÅ –î–µ–º–æ

> ![](/specification/others/img/cracks.gif)

---

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ —Ç—Ä–µ—â–∏–Ω—ã –ø–æ —ç–∫—Ä–∞–Ω—É:
    - —Ä–∞–¥–∏–∞–ª—å–Ω—ã–µ –≤–µ—Ç–≤–∏;
    - ¬´—Ñ–æ—Ä–∫–∏¬ª (—Ä–∞–∑–≤–µ—Ç–≤–ª–µ–Ω–∏—è);
    - –º–µ–ª–∫–∏–µ –æ—Å–∫–æ–ª–æ—á–Ω—ã–µ —Ç—Ä–µ—â–∏–Ω—ã –≤–æ–∫—Ä—É–≥ —ç–ø–∏—Ü–µ–Ω—Ç—Ä–∞.
- –î–≤–∞ —Å–ª–æ—è —ç—Ñ—Ñ–µ–∫—Ç–∞:
    - **crack_distort.agsl** ‚Äî –∏—Å–∫–∞–∂–∞–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç (—Ñ–æ–Ω) –≤–æ–∫—Ä—É–≥ —Ç—Ä–µ—â–∏–Ω—ã;
    - **crack_shader.agsl** ‚Äî —Ä–∏—Å—É–µ—Ç —Å–∞–º–∏ —Ç—Ä–µ—â–∏–Ω—ã –ø–æ–≤–µ—Ä—Ö –∫–æ–Ω—Ç–µ–Ω—Ç–∞.
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:
    - —Ç–∞–ø –ø–æ —ç–∫—Ä–∞–Ω—É ‚Äî –¥–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ—â–∏–Ω—É;
    - —Ç–∞–ø –ø–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ç—Ä–µ—â–∏–Ω–µ ‚Äî —É—Å–∏–ª–∏—Ç—å –µ—ë (–±–æ–ª—å—à–µ –≤–µ—Ç–≤–µ–π, —Ä–∞–¥–∏—É—Å).
- –¢–æ–Ω–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:
    - —Ç–æ–ª—â–∏–Ω–∞ –ª–∏–Ω–∏–π, jitter, —Å–∏–ª–∞ ¬´–æ—Ä–µ–æ–ª–∞¬ª, —Ä–∞–¥–∏—É—Å –¥–∏—Å—Ç–æ—Ä—Å–∏–∏, –º–∞–∫—Å–∏–º—É–º —Ç—Ä–µ—â–∏–Ω.
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π CPU-–æ–≤–µ—Ä–ª–µ–π –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –≥–µ–æ–º–µ—Ç—Ä–∏–∏ —Ç—Ä–µ—â–∏–Ω.

---

## ‚öôÔ∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Android 13+ (API 33, Tiramisu)** ‚Äî AGSL –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞—è —Å Android 13.
- **Jetpack Compose** (UI + Material3).
- –í–∫–ª—é—á–µ–Ω—ã raw-—Ä–µ—Å—É—Ä—Å—ã:
    - `res/raw/crack_distort.agsl`
    - `res/raw/crack_shader.agsl`

–î–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –Ω–∏–∂–µ Android 13 –º–æ–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∑–∞–≥–ª—É—à–∫—É (`LegacyCrackScreen`).

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞

–ü—Ä–æ—Å—Ç–µ–π—à–∏–π —Å–ø–æ—Å–æ–± ‚Äî –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π –¥–µ–º–æ-—ç–∫—Ä–∞–Ω —Å fallback‚Äô–æ–º:

```kotlin
@Composable
fun CrackSampleScreen() {
    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.TIRAMISU) {
        CrackDemoScreen()
    } else {
        LegacyCrackScreen()
    }
}
```

- –ù–∞ Android 13+ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–≤–∏–¥–∏—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —Ç—Ä–µ—â–∏–Ω—ã.
- –ù–∞ –±–æ–ª–µ–µ —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏—è—Ö ‚Äî –∑–∞–≥–ª—É—à–∫—É —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º.

---

### 2. –í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ –≤ —Å–≤–æ–π —ç–∫—Ä–∞–Ω

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤—Å—Ç—Ä–æ–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π layout:

```kotlin
@RequiresApi(Build.VERSION_CODES.TIRAMISU)
@Composable
fun MyScreenWithCracks() {
    val crackState = rememberCrackState()

    CrackRoot(
        state = crackState,
        distortion = true // –º–æ–∂–Ω–æ –≤—ã–∫–ª—é—á–∏—Ç—å –¥–∏—Å—Ç–æ—Ä—Å–∏—é, –æ—Å—Ç–∞–≤–∏–≤ —Ç–æ–ª—å–∫–æ —Ç—Ä–µ—â–∏–Ω—ã
    ) {
        // –í–∞—à –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ–¥ —Ç—Ä–µ—â–∏–Ω–∞–º–∏
        Box(
            Modifier
                .fillMaxSize()
                .background(/* –≤–∞—à –≥—Ä–∞–¥–∏–µ–Ω—Ç/—Ñ–æ–Ω */)
        ) {
            // ...
        }
    }
}
```

`CrackRoot`:

- –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç;
- –Ω–∞–≤–µ—à–∏–≤–∞–µ—Ç —Ñ–æ–Ω-–¥–∏—Å—Ç–æ—Ä—Å–∏—é (`crackDistortionEffect`) –ø—Ä–∏ `distortion = true`;
- –ø–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–ª–æ–π —Ç—Ä–µ—â–∏–Ω —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Ç–∞–ø–æ–≤.

---

## üß© API –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

### `CrackRoot`

```kotlin
@RequiresApi(Build.VERSION_CODES.TIRAMISU)
@Composable
fun CrackRoot(
    modifier: Modifier = Modifier,
    state: CrackState = rememberCrackState(),
    distortion: Boolean = true,
    content: @Composable BoxScope.() -> Unit
)
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

- `state` ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç—Ä–µ—â–∏–Ω (—Å–ø–∏—Å–æ–∫ —Å–µ–º—è–Ω –∏ –ª–æ–≥–∏–∫–∞ add/boost).
- `distortion` ‚Äî –≤–∫–ª—é—á–∞–µ—Ç/–≤—ã–∫–ª—é—á–∞–µ—Ç —Ñ–æ–Ω–æ–≤—É—é –¥–∏—Å—Ç–æ—Ä—Å–∏—é (`crack_distort.agsl`).
- `content` ‚Äî –≤–∞—à UI, –ø–æ–≤–µ—Ä—Ö –∫–æ—Ç–æ—Ä–æ–≥–æ —Ä–∏—Å—É—é—Ç—Å—è —Ç—Ä–µ—â–∏–Ω—ã.

---

### `CrackState` –∏ `CrackSeed`

```kotlin
@Stable
class CrackState(
    initial: List<CrackSeed> = emptyList(),
    private val maxSeeds: Int = CRACK_MAX_SEEDS
) {
    val seeds: List<CrackSeed>
    fun addOrBoost(at: Offset)
}

data class CrackSeed(
    val x: Float,
    val y: Float,
    val power: Float,        // 0..1 ‚Äî ¬´—Å–∏–ª–∞ —É–¥–∞—Ä–∞¬ª, –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞–¥–∏—É—Å, —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–∏—Å—É–Ω–∫–∞
    val branchBoost: Float,  // 0..6 ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –±—É—Å—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤–µ—Ç–≤–µ–π
    val salt: Float = Random.nextFloat()
)
```

- `addOrBoost(at)`:
    - –µ—Å–ª–∏ —Ç–∞–ø –±–ª–∏–∑–∫–æ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ç—Ä–µ—â–∏–Ω–µ ‚Üí —É—Å–∏–ª–∏–≤–∞–µ—Ç –µ—ë (`power`/`branchBoost`);
    - –∏–Ω–∞—á–µ ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤–æ–µ —Å–µ–º—è, –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å–∞–º–æ–µ —Å—Ç–∞—Ä–æ–µ.
- `CRACK_MAX_SEEDS` ‚Äî –º–∞–∫—Å–∏–º—É–º –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç—Ä–µ—â–∏–Ω (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å —à–µ–π–¥–µ—Ä–∞–º–∏).

–°–æ–∑–¥–∞–Ω–∏–µ:

```kotlin
@Composable
fun rememberCrackState(
    initial: List<CrackSeed> = emptyList(),
    maxSeeds: Int = CRACK_MAX_SEEDS
): CrackState
```

---

### –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä `crackedEffect`

```kotlin
@RequiresApi(Build.VERSION_CODES.TIRAMISU)
fun Modifier.crackedEffect(
    seeds: List<CrackSeed>,
    thicknessDp: Dp = 3.dp,
    jitterPx: Float = 12f,
    haloStrength: Float = 0.45f,
    safetyOverlay: Boolean = false,
    debugSegments: Boolean = false
): Modifier
```

–ù–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç –ø–æ–≤–µ—Ä—Ö —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —à–µ–π–¥–µ—Ä `crack_shader.agsl`, –∫–æ—Ç–æ—Ä—ã–π —Ä–∏—Å—É–µ—Ç —Ç—Ä–µ—â–∏–Ω—ã:

- `thicknessDp` ‚Äî —Ç–æ–ª—â–∏–Ω–∞ —Ç—Ä–µ—â–∏–Ω.
- `jitterPx` ‚Äî ¬´–Ω–µ—Ä–æ–≤–Ω–æ—Å—Ç—å¬ª –ª–∏–Ω–∏–π (–≤–æ–ª–Ω–∏—Å—Ç–æ—Å—Ç—å).
- `haloStrength` ‚Äî —Å–∏–ª–∞ —Å–≤–µ—Ç–ª–æ–≥–æ –æ—Ä–µ–æ–ª–∞ –≤–æ–∫—Ä—É–≥ —Ç—Ä–µ—â–∏–Ω—ã.
- `safetyOverlay` –∏ `debugSegments` ‚Äî –≤–∫–ª—é—á–∞—é—Ç CPU-–æ–≤–µ—Ä–ª–µ–π –≥–µ–æ–º–µ—Ç—Ä–∏–∏ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏).

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ `CrackRoot`, –Ω–æ –º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏ –≤—Ä—É—á–Ω—É—é, –µ—Å–ª–∏ –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ overlay.

---

### –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä `crackDistortionEffect`

```kotlin
@RequiresApi(Build.VERSION_CODES.TIRAMISU)
fun Modifier.crackDistortionEffect(
    seeds: List<CrackSeed>,
    strengthPx: Float = 3.5f,
    radiusPx: Float = 180f
): Modifier
```

–ü—Ä–∏–º–µ–Ω—è–µ—Ç AGSL-—à–µ–π–¥–µ—Ä `crack_distort.agsl` —á–µ—Ä–µ–∑ `RenderEffect`:

- –∏—Å–∫–∞–∂–∞–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Å–µ–º–ø–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤–±–ª–∏–∑–∏ –∫–∞–∂–¥–æ–π —Ç—Ä–µ—â–∏–Ω—ã;
- —Å–æ–∑–¥–∞—ë—Ç —ç—Ñ—Ñ–µ–∫—Ç ¬´–≤–æ–ª–Ω—ã¬ª/¬´—Å–º–µ—â–µ–Ω–∏—è¬ª –≤–æ–∫—Ä—É–≥ —Ç–æ—á–∫–∏ —É–¥–∞—Ä–∞.

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

- `strengthPx` ‚Äî —Å–∏–ª–∞ –∏—Å–∫–∞–∂–µ–Ω–∏—è (—Å–º–µ—â–µ–Ω–∏–µ –ø–∏–∫—Å–µ–ª–µ–π).
- `radiusPx` ‚Äî —Ä–∞–¥–∏—É—Å –≤–ª–∏—è–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ —Å–µ–º–µ–Ω–∏.

---

## üß† –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç (–≤ –¥–≤—É—Ö —Å–ª–æ–≤–∞—Ö)

- –ü—Ä–∏ —Ç–∞–ø–µ:
    - —á–µ—Ä–µ–∑ `pointerInput + awaitEachGesture + awaitFirstDown` –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –ø–æ–∑–∏—Ü–∏—è —Ç–∞–ø–∞;
    - `CrackState.addOrBoost` –ª–∏–±–æ —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π `CrackSeed`, –ª–∏–±–æ —É—Å–∏–ª–∏–≤–∞–µ—Ç –±–ª–∏–∂–∞–π—à–∏–π.
- –ù–∞ GPU:
    - `crack_shader.agsl`:
        - –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ–º–µ–Ω–∏(–æ–¥–Ω–∞ —Ç–æ—á–∫–∞ —Ç—Ä–µ—â–∏–Ω—ã) –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–∞–±–æ—Ä –≤–µ—Ç–≤–µ–π –∏ –æ—Å–∫–æ–ª–∫–æ–≤;
        - —Å—á–∏—Ç–∞–µ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –ø–∏–∫—Å–µ–ª—è –¥–æ –±–ª–∏–∂–∞–π—à–µ–π –≤–µ—Ç–≤–∏/–æ—Å–∫–æ–ª–∫–∞;
        - –ø–æ —ç—Ç–æ–º—É —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å —Ç—ë–º–Ω–æ–≥–æ —è–¥—Ä–∞, —Å–≤–µ—Ç–ª–æ–≥–æ ¬´—Ö—Ä–µ–±—Ç–∞¬ª –∏ –æ—Ä–µ–æ–ª–∞.
    - `crack_distort.agsl`:
        - –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –¥–æ —Å–µ–º–µ–Ω–∏ –¥–≤–∏–≥–∞–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—É –≤—ã–±–æ—Ä–∫–∏ `content.eval(uv)`;
        - –±–ª–∏–∂–µ –∫ —Å–µ–º–µ–Ω–∏ ‚Äî —Å–∏–ª—å–Ω–µ–µ, –¥–∞–ª—å—à–µ ‚Äî —Å–ª–∞–±–µ–µ, —Å –Ω–µ–±–æ–ª—å—à–∏–º —à—É–º–æ–º.
- –ù–∞ CPU (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
    - `OverlayGeometry.build(...)` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–∞–±–æ—Ä –æ—Ç—Ä–µ–∑–∫–æ–≤ —Ç—Ä–µ—â–∏–Ω;
    - `drawOverlayLines(...)` —Ä–∏—Å—É–µ—Ç –∏—Ö –ø–æ–≤–µ—Ä—Ö –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏.

---

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ —Å–µ–º–µ–Ω–∞–º: `CRACK_MAX_SEEDS = 16`.
- –î–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏:
    - —É–º–µ–Ω—å—à–∏—Ç–µ `CRACK_MAX_SEEDS`;
    - —É–º–µ–Ω—å—à–∏—Ç–µ `jitterPx`, `haloStrength` –∏ `thicknessDp`;
    - –æ—Ç–∫–ª—é—á–∏—Ç–µ `debugSegments` –∏ `safetyOverlay` –≤ –ø—Ä–æ–¥–µ.
- AGSL-—à–µ–π–¥–µ—Ä—ã –∏—Å–ø–æ–ª–Ω—è—é—Ç—Å—è –Ω–∞ GPU, –Ω–æ –≤—Å—ë —Ä–∞–≤–Ω–æ —Å—Ç–æ–∏—Ç –∏–∑–±–µ–≥–∞—Ç—å –ª–∏—à–Ω–∏—Ö –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–æ–∫ (–æ—Å–æ–±–µ–Ω–Ω–æ –Ω–∞
  —Å–ª–æ–∂–Ω—ã—Ö —Ñ–æ–Ω–∞—Ö).

---
